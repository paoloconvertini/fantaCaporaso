<div class="admin-content">

  <!-- CONTROLLI DI RUOLO E DURATA -->
  <div class="role-controls">
    <mat-button-toggle-group [(ngModel)]="role" (change)="changeRole()" class="role-toggle">
      <mat-button-toggle value="">T</mat-button-toggle>
      <mat-button-toggle value="PORTIERE">P</mat-button-toggle>
      <mat-button-toggle value="DIFENSORE">D</mat-button-toggle>
      <mat-button-toggle value="CENTROCAMPISTA">C</mat-button-toggle>
      <mat-button-toggle value="ATTACCANTE">A</mat-button-toggle>

      <button mat-icon-button color="primary" (click)="startAuction()" matTooltip="Inizia asta" [disabled]="!role">
        <mat-icon>play_arrow</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="closeAuction()" matTooltip="Chiudi asta">
        <mat-icon>stop</mat-icon>
      </button>
    </mat-button-toggle-group>

    <div class="duration">
      <mat-icon>timer</mat-icon>
      <button mat-mini-fab color="primary" (click)="decreaseDuration()">
        <mat-icon>remove</mat-icon>
      </button>
      <input type="number" [(ngModel)]="duration" min="5" class="timer-input" /> s
      <button mat-mini-fab color="primary" (click)="increaseDuration()">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>

  <div class="main-layout">
    <!-- COLONNA SINISTRA -->
    <section class="left-col">
      <div class="progress-info">
        <button mat-mini-fab color="accent"
                class="fab-reset-giro"
                (click)="resetSkip()"
                matTooltip="Ricomincia giro">
          <mat-icon>change_circle</mat-icon>
        </button>&nbsp;&nbsp;&nbsp;
        <span>alla fine <b>{{ remainingCount }}</b></span>&nbsp;&nbsp;
        <span>scartati <b>{{ skippedCount }}</b></span>
        <button mat-icon-button color="primary" (click)="start()" matTooltip="Avvia RoundModel">
          <mat-icon>play_arrow</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="close()" matTooltip="Chiudi RoundModel">
          <mat-icon>stop</mat-icon>
        </button>
        <button mat-icon-button (click)="reset()" matTooltip="Reset RoundModel">
          <mat-icon>restart_alt</mat-icon>
        </button>
      </div>

      <!-- HERO GIOCATORE -->
      <div class="hero-wrap">
        <!-- Prev a SINISTRA -->
        <button mat-icon-button class="nav-btn prev-btn"
                (click)="prev()" matTooltip="Indietro">
          <mat-icon>chevron_left</mat-icon>
        </button>

        <!-- Contenuti giocatore -->
        <ng-container *ngIf="player; else waitingTpl">
          <div class="player-hero">
            <div class="player-name">{{ player }}</div>
            <div class="player-team">{{ team }}</div>
            <div class="player-meta">
              <span class="player-value">{{ value }} FVM</span>
              <span class="role-tag"
                    [ngClass]="{
                      difensore: prole==='DIFENSORE',
                      portiere: prole==='PORTIERE',
                      centrocampista: prole==='CENTROCAMPISTA',
                      attaccante: prole==='ATTACCANTE'
                    }">
                {{ prole | slice:0:1 }}
              </span>
            </div>
          </div>
        </ng-container>

        <ng-template #waitingTpl>
          <div class="player-waiting">
            <mat-icon class="big-icon">access_time</mat-icon>
            <h2>In attesa...</h2>
            <p>Nessun giocatore selezionato</p>
          </div>
        </ng-template>

        <!-- Skip a DESTRA -->
        <button mat-icon-button class="nav-btn skip-btn"
                (click)="skip()" matTooltip="Salta">
          <mat-icon>skip_next</mat-icon>
        </button>

        <!-- Assegna in BASSO-DESTRA -->
        <button mat-fab color="primary"
                class="fab-assign"
                (click)="openManualAssign()"
                matTooltip="Assegna manualmente">
          <mat-icon>person_add</mat-icon>
        </button>
      </div>
    </section>

    <!-- COLONNA DESTRA -->
    <section class="right-col">
      <!-- Timer + Attivi se round aperto -->
      <div *ngIf="round && !round.closed; else bidsBlock" class="timer-and-actives">
        <div class="timer-card">
          <div class="timer-label">Tempo</div>
          <div class="timer-big">{{ timeLeft !== null ? (timeLeft + 's') : '‚Äî' }}</div>
        </div>

        <mat-card class="list-card actives-card">
          <h3>Chi sta puntando</h3>
          <div *ngFor="let user of activeUsers" class="list-row">
            <span class="list-user">{{ user }}</span>
          </div>
          <div *ngIf="activeUsers.length===0" class="muted">Nessuno</div>
        </mat-card>
      </div>

      <!-- Puntate se round chiuso -->
      <ng-template #bidsBlock>
        <mat-card class="list-card bids-card">
          <h3>Puntate</h3>
          <div class="list-row" *ngFor="let row of sortedBids">
            <span class="list-user">{{ row.user }}</span>
            <span class="list-amount">{{ row.amount }}</span>
          </div>
          <div class="winner" *ngIf="round?.winner">
            üèÜ Vincitore: <b>{{ round.winner.user }}</b> ({{ round.winner.amount }})
          </div>
          <div *ngIf="!round?.winner" class="muted">Nessun vincitore (parit√†)</div>
          <div *ngIf="!round?.winner && round?.tieUsers?.length" class="tie-info">
            ‚öñÔ∏è Spareggio tra:
            <ul><li *ngFor="let u of round.tieUsers">{{ u }}</li></ul>
          </div>
        </mat-card>
      </ng-template>

      <!-- Overlay vincitore -->
      <div *ngIf="showWinnerOverlay && winnerPayload" class="winner-overlay">
        <div class="winner-card">
          <h1>üèÜ {{ winnerPayload.user }}</h1>
          <p>
            Si aggiudica
            <strong>{{ winnerPayload.player }}</strong>
            per <strong>{{ winnerPayload.amount }}</strong> crediti!
          </p>
        </div>
      </div>
    </section>
  </div>

  <!-- Loader assegnazione -->
  <div *ngIf="loadingAssign" class="assign-loader-overlay">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Assegnazione in corso...</p>
  </div>
</div>
